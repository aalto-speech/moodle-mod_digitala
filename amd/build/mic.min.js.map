{"version":3,"sources":["../src/mic.js"],"names":["recorder","isRecording","audio","startStopRecording","pagenum","navigator","mediaDevices","getUserMedia","then","stream","options","audioBitsPerSecond","type","recorderType","RecordRTC","StereoAudioRecorder","mimeType","startRecording","window","console","log","catch","err","error","stopRecording","audioBlob","getBlob","audioUrl","URL","createObjectURL","Audio","document","getElementById","style","display","reader","FileReader","readAsDataURL","onload","result","forms","answerrecording","value","listenRecording","play","initializeMicrophone","recButton","stopButton","listenButton","disabled","onclick","backgroundColor"],"mappings":"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","sourcesContent":["// Standard license block omitted.\n/*\n * @module     mod_digitala/mic\n * @copyright  2022 Name\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport RecordRTC from 'RecordRTC';\n\nlet recorder;\nlet isRecording = false;\nlet audio;\n\nconst startStopRecording = (pagenum) => {\n    switch (isRecording) {\n        case false:\n            navigator.mediaDevices.getUserMedia({audio: true})\n                .then(stream => {\n                    const options = {\n                        audioBitsPerSecond: 16000,\n                        type: 'audio',\n                        recorderType: RecordRTC.StereoAudioRecorder,\n                        mimeType: 'audio/wav'\n                    };\n                    recorder = new RecordRTC(stream, options);\n                    isRecording = true;\n\n                    recorder.startRecording();\n                    window.console.log('started to record');\n\n                    return;\n                })\n                .catch((err) => {\n                    window.console.error(err);\n                });\n            break;\n\n        case true:\n            isRecording = false;\n            recorder.stopRecording(() => {\n                const audioBlob = recorder.getBlob();\n                window.console.log('audioBlob:', audioBlob);\n\n                const audioUrl = URL.createObjectURL(audioBlob);\n                audio = new Audio(audioUrl);\n                window.console.log('audioUrl', audioUrl);\n\n                window.console.log('Enable submit button');\n                document.getElementById('id_submitbutton').style.display = '';\n\n                if (pagenum === 1) {\n                    let reader = new FileReader();\n                    reader.readAsDataURL(audioBlob);\n\n                    reader.onload = () => {\n                        window.console.log('>', reader.result);\n                        document.forms.answerrecording[0].value = reader.result;\n                    };\n                }\n            });\n            window.console.log('recording stopped');\n            break;\n    }\n};\n\nconst listenRecording = () => {\n    if (audio !== undefined) {\n        audio.play();\n    }\n};\n\nexport const initializeMicrophone = (pagenum) => {\n    const recButton = document.getElementById('record');\n    const stopButton = document.getElementById('stopRecord');\n    const listenButton = document.getElementById('listenButton');\n    stopButton.disabled = true;\n    listenButton.disabled = true;\n\n    window.console.log('page number', pagenum);\n\n    recButton.onclick = () => {\n        recButton.style.backgroundColor = \"blue\";\n        recButton.disabled = true;\n        stopButton.disabled = false;\n        listenButton.style.display = 'none';\n        startStopRecording(pagenum);\n    };\n    stopButton.onclick = () => {\n        recButton.style.backgroundColor = \"red\";\n        recButton.disabled = false;\n        stopButton.disabled = true;\n        listenButton.disabled = false;\n        listenButton.style.display = 'inline-block';\n        startStopRecording(pagenum);\n    };\n    listenButton.onclick = () => {\n        listenRecording();\n    };\n};"],"file":"mic.min.js"}