define("mod_digitala/mic",["exports","RecordRTC","core/config","core/str"],(function(_exports,_RecordRTC,_config,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}var recorder;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.initializeMicrophone=void 0,_RecordRTC=_interopRequireDefault(_RecordRTC),_config=_interopRequireDefault(_config);var audio,langStrings,pagenum,assignmentId,userId,username,maxLength,timeout,fn,_ref,recButton=document.getElementById("record"),listenButton=document.getElementById("listen"),startRecording=function(){navigator.mediaDevices.getUserMedia({audio:!0}).then((function(stream){var options={audioBitsPerSecond:16e3,type:"audio",recorderType:_RecordRTC.default.StereoAudioRecorder,mimeType:"audio/wav",numberOfAudioChannels:1};(recorder=new _RecordRTC.default(stream,options)).startRecording(),window.console.log("Digitala: Started to record"),recButton.textContent=langStrings[1],recButton.onclick=stopRecording,listenButton.disabled=!0,timeout=setTimeout(stopRecording,100*maxLength)})).catch((function(err){window.console.error(err)}))},stopRecording=function(){"recording"===recorder.getState()&&(recorder.stopRecording((function(){var audioBlob=recorder.getBlob(),audioUrl=URL.createObjectURL(audioBlob);if(audio=new Audio(audioUrl),1===pagenum){var form=new FormData;form.append("repo_id","5"),form.append("ctx_id",_config.default.contextid),form.append("itemid","0"),form.append("savepath","/"),form.append("sesskey",_config.default.sesskey),form.append("repo_upload_file",audioBlob,"ans-".concat(assignmentId,"-").concat(userId,"-").concat(username,"-").concat((new Date).valueOf(),".wav")),form.append("overwrite","1");var req=new XMLHttpRequest;req.open("POST",_config.default.wwwroot+"/repository/repository_ajax.php?action=upload"),req.addEventListener("readystatechange",(function(event){4===event.target.readyState&&(document.forms.answerrecording[0].value=event.target.response,document.getElementById("id_submitbutton").style.display="")})),req.send(form)}recButton.textContent=langStrings[0],recButton.onclick=startRecording,listenButton.disabled=!1,clearTimeout(timeout)})),window.console.log("Digitala: Recording stopped"))},listenRecording=function(){var microphoneIcon=document.getElementById("microphoneIconBox");void 0!==audio?(audio.play(),0===pagenum&&(microphoneIcon.style.border="2.5px dashed green")):0===pagenum&&(microphoneIcon.style.border="2.5px dashed red")},initializeMicrophone=(fn=regeneratorRuntime.mark((function _callee(pagenumIn,assignmentIdIn,userIdIn,usernameIn,maxLengthIn){return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return window.console.log("Digitala: Starting to initalize microphones"),pagenum=pagenumIn,assignmentId=assignmentIdIn,userId=userIdIn,username=usernameIn,maxLength=maxLengthIn,_context.next=8,(0,_str.get_strings)([{key:"startbutton-again",component:"digitala"},{key:"stopbutton",component:"digitala"}]);case 8:langStrings=_context.sent,2!==pagenum&&(recButton.onclick=startRecording,listenButton.onclick=listenRecording);case 10:case"end":return _context.stop()}}),_callee)})),_ref=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(_x,_x2,_x3,_x4,_x5){return _ref.apply(this,arguments)});_exports.initializeMicrophone=initializeMicrophone}));

//# sourceMappingURL=mic.min.js.map